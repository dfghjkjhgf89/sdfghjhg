{% extends "base.html" %}

{% block title %}–û—Ç—á–µ—Ç –ø–æ –ø–æ–¥–ø–∏—Å–∫–∞–º{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>üìä –û—Ç—á–µ—Ç –ø–æ –ø–æ–¥–ø–∏—Å–∫–∞–º (–∑–∞ —Å–µ–≥–æ–¥–Ω—è)</h2>

    <div class="row mt-4">
        <!-- –û–ø–ª–∞—Ç—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">üí≥ –û–ø–ª–∞—á–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è</h5>
                </div>
                <div class="card-body">
                    {% if payments_today %}
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>–í—Ä–µ–º—è</th>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>–°—É–º–º–∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for payment in payments_today %}
                                <tr>
                                    <td>{{ payment.created_at.strftime('%H:%M:%S') }}</td>
                                    <td>
                                        <a href="{{ url_for('user_details', user_id=payment.user.id) }}">
                                            {{ payment.user.telegram_username or payment.user.telegram_id }}
                                        </a>
                                    </td>
                                    <td>{{ payment.amount }}‚ÇΩ</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-3">
                        <strong>–í—Å–µ–≥–æ –æ–ø–ª–∞—Ç:</strong> {{ payments_today|length }}
                        <br>
                        <strong>–û–±—â–∞—è —Å—É–º–º–∞:</strong> {{ payments_today|sum(attribute='amount') }}‚ÇΩ
                    </div>
                    {% else %}
                    <p class="text-muted mb-0">–°–µ–≥–æ–¥–Ω—è –æ–ø–ª–∞—Ç –ø–æ–∫–∞ –Ω–µ –±—ã–ª–æ.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- –ó–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏–µ—Å—è –ø–æ–¥–ø–∏—Å–∫–∏ -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h5 class="card-title mb-0">‚è≥ –ó–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —Å–µ–≥–æ–¥–Ω—è</h5>
                </div>
                <div class="card-body">
                    {% if ending_today %}
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>–í—Ä–µ–º—è</th>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>–ê–≤—Ç–æ–ø–ª–∞—Ç–µ–∂</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for sub in ending_today %}
                                <tr>
                                    <td>{{ sub.end_date.strftime('%H:%M:%S') }}</td>
                                    <td>
                                        <a href="{{ url_for('user_details', user_id=sub.user.id) }}">
                                            {{ sub.user.telegram_username or sub.user.telegram_id }}
                                        </a>
                                    </td>
                                    <td>
                                        {% if sub.auto_payment %}
                                        <span class="badge bg-success">–í–∫–ª—é—á–µ–Ω</span>
                                        {% else %}
                                        <span class="badge bg-danger">–û—Ç–∫–ª—é—á–µ–Ω</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-3">
                        <strong>–í—Å–µ–≥–æ –ø–æ–¥–ø–∏—Å–æ–∫:</strong> {{ ending_today|length }}
                    </div>
                    {% else %}
                    <p class="text-muted mb-0">–ü–æ–¥–ø–∏—Å–æ–∫, –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏—Ö—Å—è —Å–µ–≥–æ–¥–Ω—è, –Ω–µ—Ç.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}